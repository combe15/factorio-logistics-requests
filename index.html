<script
    src="https://code.jquery.com/jquery-3.6.0.js"
    integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>


<script src="pako.js"></script>

<html>
    <style>
        .rowproto {
            visibility: hidden;
        }
    </style>

    <h2>Configuration</h2>
    
    <div class="rowproto">
        <label>Item</label><input class="item" type="text"></input>
        <label>Minimum</label><input class="min" type="text"></input>
        <label>Maximum</label><input class="max" type="text"></input>
        <button type="button" class="delbutton">-</button>
    </div>

    <div>
        <button id="addbutton" type="button">+</button>
    </div>

    <button id="generate" type="button">Generate!</button>

    <h2>Output</h2>
    <textarea id="output" rows="16" cols="80" readonly>
        /silent-command
            local c = game.player.set_personal_logistic_slot
                c(45, {max=4294967295,min=0,name=personal-roboport-equipment})
                c(46, {max=5,min=5,name=locomotive})
                c(47, {max=4294967295,min=0,name=exoskeleton-equipment})
    </textarea>

    <h2>Import/Share</h2>
    <textarea id="sharestring" rows="2" cols="80">
MTIwLDE1NiwxNDEsMTQxLDE4NywxMCwxMjgsNDgsMTYsNCwyNTUsMjI5LDEwNiw1LDE3LDMxLDE5Niw5NSwxNywxMSwxNDksNDMsMTMwLDczLDU0LDE5OCw4Myw0LDI0MSwyMjMsMTQxLDc3LDE5MiwyMDYsMTEwLDEzOCwxNTMsMjIxLDI1NCwzNCw0NSwxMDgsMTY5LDM1LDIwNyw5NywxMzEsMjcsNzcsMzAsNDgsMTkzLDM1LDcyLDIwNiwyMzUsMTc0LDE4OSwxMDEsMzksMTQ4LDE0NSwyMTMsNDYsNTgsMTk3LDc1LDIyNywyNSwxNjksNDIsODUsMTY1LDE1NCwxODIsODQsNTMsMjIxLDg5LDIxOCw0OCwxNTIsOTcsMzMsMjUwLDIyNCwxNDgsMjEyLDQxLDI0OSwxNTIsMTI0LDk4LDkxLDIxNiwxNzYsMTkyLDI1MywyNTQsMjUsMzAsMjI2LDE3OSw1MywxMjY=
    </textarea><br/>
    <button id="import" type="button">Import!</button>

    <script>
        function addRow(item, min, max) {
            rows = $('.rowproto');
            var row = rows.first();
            var newrow = row.clone();
            row.removeClass('rowproto');
            row.addClass('row');
            row.find('.item').val(item);
            row.find('.min').val(min);
            row.find('.max').val(max);
            delbutton = newrow.find('.delbutton')
            delbutton.off();
            delbutton.click(function() {
                newrow.remove();
            });
            row.after(newrow);
        };

        $('#addbutton').click(function() {
            addRow();
        });

        $('#generate').click(function() {

            shareobj = [];

            output = $('#output');
            var i = 45;
            l1 = '/silent-command';
            l2 = 'local c = game.player.set_personal_logistic_slot';
            output.text(l1 + '\n' + l2 + '\n');
            $('div.row').each(function(i, e) {
                x = $(e);
                item = x.find('input.item').val();
                min = x.find('input.min').val();
                max = x.find('input.max').val();

                shareobj.push({item:item, min:min, max:max});

                l = 'c(' + (i+45) + ', {max=' + max + ',min=' + min + ',name=' + item + '})\n';
                output.append(l);
            });

            json = JSON.stringify(shareobj);
            data = pako.deflate(json);
            encoded = btoa(data);

            $('#sharestring').text(encoded);

        });

        $('#import').click(function() {
            sharestr = $('#sharestring').text();
            data = atob(sharestr);
            splitdata = Uint8Array.from(data.split(','));
            objs = pako.inflate(splitdata);
            jsonstr = new TextDecoder().decode(objs)
            shareobj = JSON.parse(jsonstr);

            newrows = [];

            for(var i in shareobj) {
                x = shareobj[i]
                addRow(x.item, x.min, x.max);
            }
        });

    </script>


</html>
