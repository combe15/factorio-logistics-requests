<script
    src="https://code.jquery.com/jquery-3.6.0.js"
    integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>


<script src="pako.js"></script>

<html>
    <style>
        .rowproto {
            visibility: hidden;
        }
    </style>

    <h2>Instructions</h2>
    Either:<br/>
    Paste into <b>Import/Share</b> and click <b>Import</b> and then <b>Generate</b><br/>
    <br/>
    OR</br>
    </br>
    Click the <b>'+'</b> to generate new line items and then click <b>Generate</b> and then Share to your friends so they can modify/tailor their requests.<br/>
    <br/>
    Enjoy!<br/>


    <h2>Configuration</h2>

    <ul><li>max must be 4294967295 for unlimited</li></ul>

    <div class="rowproto">
        <label>Item</label><input class="item" type="text"></input>
        <label>Minimum</label><input class="min" type="text"></input>
        <label>Maximum</label><input class="max" type="text"></input>
        <button type="button" class="delbutton">-</button>
    </div>

    <div>
        <button id="addbutton" type="button">+</button>
    </div>

    <button id="generate" type="button">Generate!</button>

    <h2>Output</h2>
    <textarea id="output" rows="16" cols="80" readonly>
    </textarea>

    <h2>Import/Share</h2>
    <textarea id="sharestring" rows="2" cols="80"></textarea><br/>
    <button id="import" type="button">Import!</button>

    <script>
        function addRow(item, min, max) {
            rows = $('.rowproto');
            var row = rows.first();
            var newrow = row.clone();
            row.removeClass('rowproto');
            row.addClass('row');
            row.find('.item').val(item);
            row.find('.min').val(min);
            row.find('.max').val(max);
            var delbutton = newrow.find('.delbutton')
            delbutton.off();
            delbutton.click(function() {
                newrow.remove();
            });
            row.after(newrow);
        };

        $('#addbutton').click(function() {
            addRow('item-name', 0, 4294967295);
        });

        $('#generate').click(function() {

            var shareobj = [];

            var output = $('#output');
            var i = 45;
            var l1 = '/silent-command';
            var l2 = 'local c = game.player.set_personal_logistic_slot';
            output.val(l1 + '\n' + l2 + '\n');
            $('div.row').each(function(i, e) {
                var x = $(e);
                var item = x.find('input.item').val();
                var min = x.find('input.min').val();
                var max = x.find('input.max').val();

                shareobj.push({item:item, min:min, max:max});

                l = 'c(' + (i+45) + ', {max=' + max + ',min=' + min + ',name=\'' + item + '\'})\n';
                output.append(l);
            });

            var json = JSON.stringify(shareobj);
            var data = pako.deflate(json);
            var encoded = btoa(data);

            alert(encoded);
            $('#sharestring').val(encoded);

        });

        $('#import').click(function() {
            var sharestr = $('#sharestring').val();
            var data = atob(sharestr);
            var splitdata = Uint8Array.from(data.split(','));
            var objs = pako.inflate(splitdata);
            var jsonstr = new TextDecoder().decode(objs)
            var shareobj = JSON.parse(jsonstr);

            var newrows = [];

            for(var i in shareobj) {
                var x = shareobj[i]
                addRow(x.item, x.min, x.max);
            }
        });

    </script>


</html>
